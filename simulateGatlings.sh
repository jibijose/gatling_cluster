#!/bin/bash

echo "******************************************************************************************************************"
echo "*********************************************** Gatling Simulation Started ***************************************"

if [ "$#" -ne 2 ]
then
    echo "$0 Cloud SimulationClass"
    exit 1
fi
CLOUD=$1
SIMULATION_NAME=$2

echo "******************************************************************************************************************"
echo "*********************************************** Variable Setup ***************************************************"
. ./variablesGatlings.sh $CLOUD $SIMULATION_NAME

echo "******************************************************************************************************************"
echo "*********************************************** Local Setup ******************************************************"
./setupLocal.sh

echo "******************************************************************************************************************"
echo "*********************************************** Gatling Apply ***************************************************"
cd $CLOUD
terraform init
terraform apply -var "my_public_ip=`curl ifconfig.me`" -auto-approve
cd ..

echo "******************************************************************************************************************"
echo "*********************************************** Gatling Setup ****************************************************"
./setupGatlings.sh $CLOUD $SIMULATION_NAME
echo "******************************************************************************************************************"
echo "*********************************************** Gatling Start ****************************************************"
./startGatlings.sh $CLOUD $SIMULATION_NAME
echo "******************************************************************************************************************"
echo "*********************************************** Gatling Wait *****************************************************"
./waitGatlings.sh $CLOUD $SIMULATION_NAME
echo "******************************************************************************************************************"
echo "*********************************************** Gatling Result ***************************************************"
./resultGatlings.sh $CLOUD $SIMULATION_NAME

echo "******************************************************************************************************************"
echo "*********************************************** Gatling destroy **************************************************"
cd $CLOUD
terraform destroy -var "my_public_ip=`curl ifconfig.me`" -auto-approve
cd ..

echo "******************************************************************************************************************"
echo "*********************************************** Gatling Simulation Success ***************************************"